#!/bin/bash
set -e

REPO_GIT="https://github.com/yzeusy/BadVPN.git"
INSTALL_DIR="/etc/badvpn"

echo "üì¶ Instalando BadVPN em $INSTALL_DIR"

# Depend√™ncias m√≠nimas
apt update -y
apt install -y git wget

# Remover instala√ß√£o antiga
rm -rf $INSTALL_DIR

# Clonar reposit√≥rio
git clone $REPO_GIT $INSTALL_DIR

cd $INSTALL_DIR

# Detectar arquitetura
ARCH=$(uname -m)
case "$ARCH" in
  x86_64) ARCH_DIR="amd64" ;;
  aarch64|arm64) ARCH_DIR="arm64" ;;
  *)
    echo "‚ùå Arquitetura n√£o suportada: $ARCH"
    exit 1
    ;;
esac

echo "üß† Arquitetura detectada: $ARCH_DIR"

# Instalar bin√°rios
install -Dm755 bin/$ARCH_DIR/badvpn-server /usr/local/bin/badvpn-server
install -Dm755 bin/$ARCH_DIR/badvpn-udpgw /usr/local/bin/badvpn-udpgw
install -Dm755 bin/$ARCH_DIR/badvpn-tun2socks /usr/local/bin/badvpn-tun2socks

# Instalar comando √∫nico
install -Dm755 badvpnctl /usr/local/bin/badvpn

# Instalar systemd
install -Dm644 badvpn.service /etc/systemd/system/badvpn.service

systemctl daemon-reexec
systemctl daemon-reload
systemctl enable badvpn

echo "‚úÖ BadVPN instalado com sucesso!"
echo "üëâ Menu: sudo /etc/badvpn/badvpn-menu.sh"
echo "üëâ Comando: badvpn start | stop | status"
