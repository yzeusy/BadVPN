#!/bin/bash

set -e

REPO="https://raw.githubusercontent.com/yzeusy/BadVPN/main"

ARCH=$(uname -m)
case "$ARCH" in
  x86_64) ARCH_DIR="amd64" ;;
  aarch64|arm64) ARCH_DIR="arm64" ;;
  *)
    echo "‚ùå Arquitetura n√£o suportada: $ARCH"
    exit 1
    ;;
esac

echo "üì¶ Arquitetura detectada: $ARCH_DIR"

TMP=$(mktemp -d)
cd "$TMP"

echo "‚¨áÔ∏è Baixando bin√°rios..."
for f in badvpn-server badvpn-udpgw badvpn-tun2socks; do
  wget -q "$REPO/bin/$ARCH_DIR/$f"
  chmod +x "$f"
done

install -Dm755 badvpn-server /usr/local/bin/badvpn-server
install -Dm755 badvpn-udpgw /usr/local/bin/badvpn-udpgw
install -Dm755 badvpn-tun2socks /usr/local/bin/badvpn-tun2socks

echo "‚¨áÔ∏è Instalando scripts..."
wget -q "$REPO/badvpnctl"
wget -q "$REPO/badvpn.service"

install -Dm755 badvpnctl /usr/local/bin/badvpn
install -Dm644 badvpn.service /etc/systemd/system/badvpn.service

mkdir -p /etc/badvpn

systemctl daemon-reexec
systemctl daemon-reload
systemctl enable badvpn

echo "‚úÖ Instala√ß√£o conclu√≠da!"
echo "üëâ Use: badvpn start | stop | status"
